import{k as p,b as g,o as h,a as f,w,d as y,G as b,e as n,K as k,C as S,F as x}from"./app-DcPAJhii.js";import{S as _}from"./SignInModal-FwFOPLKM.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";async function N(){try{let o=localStorage.getItem("accessToken");const i="https://payment-service.dev.apero.vn";if(!o)throw new Error("Access token not found in localStorage");const t=await fetch(`${i}/saas-payment-service/v1/stripe/billing-portal-session`,{method:"POST",headers:{"x-api-bundleid":"com.astronex.hekaai",Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({callbackUrl:"/"})});if(!t.ok){const e=await t.json();throw new Error(`Request failed: ${t.status} - ${e.message||"Unknown error"}`)}return(await t.json()).url}catch{return null}}async function $(o){showLoadingScreen();let i=localStorage.getItem("accessToken");const t="https://payment-service.dev.apero.vn",s="com.astronex.hekaai";localStorage.getItem("redirectUri");const e=window.location.origin,a=await P(o);if(console.log("product: ",a),!a){hideLoadingScreen();return}console.log("product: ",a.price.id);try{const r={cart:[{stripePriceId:a.price.id,quantity:1,name:a.name}],successUrl:`${e}/payment/success`,cancelUrl:`${e}/payment/cancel`},c=await fetch(`${t}/saas-payment-service/v1/stripe/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`,"x-api-bundleid":s},body:JSON.stringify(r)}),l=await c.json();hideLoadingScreen(),c.ok&&(l!=null&&l.url)?window.location.href=l.url:(window.location.href="/",hideLoadingScreen())}catch{window.location.href="/",hideLoadingScreen()}}async function P(o){const i="https://payment-service.dev.apero.vn",t="com.astronex.hekaai",s=localStorage.getItem("accessToken");try{const e=await fetch(`${i}/saas-payment-service/v1/stripe/products`,{method:"GET",headers:{Authorization:`Bearer ${s}`,"x-api-bundleid":t}}),a=await e.json();if(e.ok&&Array.isArray(a.data))return a.data.find(r=>{var c;return((c=r.price)==null?void 0:c.id)===o})}catch(e){console.error("Lỗi lấy sản phẩm:",e)}return null}const C={class:"relative z-10 flex flex-col items-center text-center text-white p-6"},T={class:"grid grid-cols-2 gap-2 w-full mx-auto",style:{"padding-top":"21rem"}},L=["src"],j=["src"],z={__name:"PaywallModal",props:{visible:Boolean,backgroundUrl:{type:String,required:!0}},emits:["close","accepted","showSignInModal"],setup(o,{emit:i}){const t=p(!1),s=i,e=p("12months"),a={"1month":"price_1Rv9KoRCSaeQZuQ8X3z9HPcZ","12months":"price_1Rv9L2RCSaeQZuQ8UYdpvLun"},r=()=>s("close"),c=()=>{const d=a[e.value];if(localStorage.setItem("priceId",d),!localStorage.getItem("accessToken")){s("showSignInModal"),r();return}$(d),s("accepted",d)},l=d=>{e.value=d},v=()=>{isLoggedIn.value=!0,t.value=!1};return(d,u)=>(h(),g(x,null,[f(S,{name:"fade"},{default:w(()=>[o.visible?(h(),g("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center w-full h-full overflow-x-hidden overflow-y-auto bg-black bg-opacity-70",onKeydown:b(r,["esc"])},[n("div",{class:"relative w-full max-w-[270px] mx-auto rounded-2xl overflow-hidden shadow-lg",style:k({background:`url('${o.backgroundUrl}') no-repeat center center/cover`})},[n("button",{onClick:r,class:"absolute top-3 right-3 z-20 w-6 h-6 text-white bg-black bg-opacity-40 hover:bg-opacity-70 rounded-full flex items-center justify-center text-xs"}," ✕ "),n("div",C,[n("div",T,[n("div",{onClick:u[0]||(u[0]=m=>l("1month")),class:"cursor-pointer"},[n("img",{src:e.value==="1month"?"/images/onboarding/modal/1month_active.png":"/images/onboarding/modal/1month.png",alt:"1 month",class:"w-full"},null,8,L)]),n("div",{onClick:u[1]||(u[1]=m=>l("12months")),class:"cursor-pointer"},[n("img",{src:e.value==="12months"?"/images/onboarding/modal/12months_active.png":"/images/onboarding/modal/12months.png",alt:"12 months",class:"w-full"},null,8,j)])]),n("button",{onClick:c,class:"mt-2 w-full bg-gradient-to-r from-yellow-300 to-yellow-500 text-black font-bold py-2 rounded-xl shadow-md"}," Go Premium Now ")])],4)],32)):y("",!0)]),_:1}),f(_,{visible:t.value,onClose:u[2]||(u[2]=m=>t.value=!1),onLogin:v},null,8,["visible"])],64))}},B=I(z,[["__scopeId","data-v-dd940dda"]]),O=Object.freeze(Object.defineProperty({__proto__:null,default:B},Symbol.toStringTag,{value:"Module"}));export{B as P,$ as a,O as b,N as c};
