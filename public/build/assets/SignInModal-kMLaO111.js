import{k as v,c as S,o as w,w as x,b as I,d as k,G as _,e as i,g as y,C}from"./app-1y3rKquk.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";function U(e){return e.replace(/\./g,"-")}function L(){return Math.random().toString(36).substring(2,16)}function V(e=64){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~";let r="";const n=new Uint8Array(e);return window.crypto.getRandomValues(n),n.forEach(c=>{r+=t[c%t.length]}),r}async function j(e){const r=new TextEncoder().encode(e),n=await window.crypto.subtle.digest("SHA-256",r);return A(n)}function A(e){const t=new Uint8Array(e);let r="";return t.forEach(n=>r+=String.fromCharCode(n)),btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function h(){document.body.style.overflow="hidden"}function u(){document.body.style.overflow="auto"}const a=[];for(let e=0;e<256;++e)a.push((e+256).toString(16).slice(1));function M(e,t=0){return(a[e[t+0]]+a[e[t+1]]+a[e[t+2]]+a[e[t+3]]+"-"+a[e[t+4]]+a[e[t+5]]+"-"+a[e[t+6]]+a[e[t+7]]+"-"+a[e[t+8]]+a[e[t+9]]+"-"+a[e[t+10]]+a[e[t+11]]+a[e[t+12]]+a[e[t+13]]+a[e[t+14]]+a[e[t+15]]).toLowerCase()}let m;const B=new Uint8Array(16);function E(){if(!m){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");m=crypto.getRandomValues.bind(crypto)}return m(B)}const O=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),b={randomUUID:O};function R(e,t,r){var c;if(b.randomUUID&&!e)return b.randomUUID();e=e||{};const n=e.random??((c=e.rng)==null?void 0:c.call(e))??E();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,M(n)}async function z(e){h();const t=V(),r=await j(t);localStorage.setItem("pkce_code_verifier",t),localStorage.setItem("idp",e),localStorage.setItem("deviceId","device-"+R());const n=U("com.astronex.hekaai"),c="application",s=window.location.origin+window.location.pathname,l=L(),o=`https://llm-oauth.apero.vn/realms/${n}/protocol/openid-connect/auth?`+new URLSearchParams({response_type:"code",client_id:c,redirect_uri:s,scope:"openid device-id profile email ancestor-id address phone group-membership",code_challenge:r,code_challenge_method:"S256",state:l,kc_idp_hint:e,prompt:"consent select_account"});u(),window.location.href=o}async function D(){try{const e=localStorage.getItem("refreshToken"),t="https://llm-account-service.apero.vn",r="com.astronex.hekaai";if(!e){window.location.href=localStorage.getItem("redirectUri")||"/",localStorage.clear();return}(await fetch(`${t}/saas-user-service/v1/users/logout`,{method:"POST",headers:{"Content-Type":"application/json","x-api-bundleid":r},body:JSON.stringify({refreshToken:e})})).ok&&(window.location.href=localStorage.getItem("redirectUri")||"/"),localStorage.clear()}catch{}}async function q(e){const t=localStorage.getItem("pkce_code_verifier"),r=localStorage.getItem("idp"),n=localStorage.getItem("deviceId"),c="com.astronex.hekaai",s="https://llm-account-service.apero.vn",l=window.location.origin+window.location.pathname;e&&(h(),fetch(s+"/saas-user-service/v1/users/silent-login-sso",{method:"POST",headers:{"Content-Type":"application/json","x-api-bundleid":c},body:JSON.stringify({code:e,codeVerifier:t,redirectUri:l,deviceId:n,idp:r})}).then(o=>o.json()).then(o=>{var d,g;(d=o==null?void 0:o.data)!=null&&d.accessToken&&((g=o==null?void 0:o.data)!=null&&g.refreshToken)?(localStorage.setItem("accessToken",o.data.accessToken),localStorage.setItem("refreshToken",o.data.refreshToken),window.location.href=l):(u(),console.error("Login failed:",o),Swal.fire({title:"Login failed",text:"Please try again.",icon:"error",confirmButtonText:"OK"}).then(()=>{window.location.href=l}))}).catch(o=>{u(),console.error("Error during login:",o)}))}async function F(){var n,c;var e=localStorage.getItem("accessToken"),t="https://llm-account-service.apero.vn",r="com.astronex.hekaai";h();try{const s=await fetch(`${t}/saas-user-service/v1/users/me`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"x-api-bundleid":r}});u();const l=await s.json();if(s.ok&&l.data){const o=l.data;o.email&&localStorage.setItem("email",o.email);const d=((c=(n=o.groups)==null?void 0:n[0])==null?void 0:c.name)||null;d&&localStorage.setItem("group_name",d);const g=o.attributes||{};for(const p in g){const f=g[p];Array.isArray(f)&&localStorage.setItem(p,f[0])}return localStorage.getItem("gender")&&localStorage.getItem("year_of_birth")&&localStorage.getItem("activity")&&localStorage.getItem("measure_type")&&localStorage.getItem("current_weight")&&localStorage.getItem("current_height")&&localStorage.getItem("target_cal"),!1}else Swal.fire({title:"Session expired",text:"Please sign in again to continue.",icon:"warning",confirmButtonText:"OK"}).then(()=>{D(),showSignInModal(!0)})}catch{}u()}const $={class:"relative w-full max-w-sm mx-auto bg-white rounded-xl shadow-lg p-6"},P={class:"flex flex-col items-center text-center space-y-4 mt-4"},N=["disabled"],H=["disabled"],K={__name:"SignInModal",props:{visible:Boolean},emits:["close","login"],setup(e,{emit:t}){const r=v(!1),n=t,c=()=>n("close"),s=l=>{r.value=!0,z(l)};return(l,o)=>(w(),S(C,{name:"fade"},{default:x(()=>[e.visible?(w(),I("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center w-full h-full overflow-x-hidden overflow-y-auto bg-black bg-opacity-70",onKeydown:_(c,["esc"])},[i("div",$,[i("button",{onClick:c,class:"absolute top-3 right-3 z-20 w-6 h-6 text-black hover:bg-gray-100 rounded-full flex items-center justify-center text-xl"}," âœ• "),i("div",P,[o[4]||(o[4]=i("h2",{class:"text-lg font-semibold text-black"},"Login to Continue",-1)),i("button",{onClick:o[0]||(o[0]=d=>s("google")),disabled:r.value,class:"flex items-center justify-center w-full border border-gray-300 rounded-full py-2 px-4 text-black hover:bg-gray-100"},o[2]||(o[2]=[i("svg",{xmlns:"http://www.w3.org/2000/svg",class:"mr-2",x:"0px",y:"0px",width:"20",height:"20",viewBox:"0 0 48 48"},[i("path",{fill:"#fbc02d",d:"M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12	s5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20	s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"}),i("path",{fill:"#e53935",d:"M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039	l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"}),i("path",{fill:"#4caf50",d:"M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36	c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"}),i("path",{fill:"#1565c0",d:"M43.611,20.083L43.595,20L42,20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571	c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"})],-1),y(" Continue with Google ")]),8,N),i("button",{onClick:o[1]||(o[1]=d=>s("apple")),disabled:r.value,class:"flex items-center justify-center w-full border border-gray-300 rounded-full py-2 px-4 text-black hover:bg-gray-100"},o[3]||(o[3]=[i("img",{src:"https://upload.wikimedia.org/wikipedia/commons/f/fa/Apple_logo_black.svg",alt:"Apple",width:"18",height:"18",class:"mr-2"},null,-1),y(" Continue with Apple ")]),8,H)])])],32)):k("",!0)]),_:1}))}},G=T(K,[["__scopeId","data-v-5a001e88"]]),Q=Object.freeze(Object.defineProperty({__proto__:null,default:G},Symbol.toStringTag,{value:"Module"}));export{G as S,Q as a,F as g,D as h,z as l,q as s};
