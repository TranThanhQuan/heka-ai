import{k as p,b as g,o as h,a as f,w,d as y,G as b,e as a,K as k,C as S,F as x}from"./app-CTS7W1yk.js";import{S as _}from"./SignInModal-Crq9uRTp.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";async function N(){try{let t=localStorage.getItem("accessToken");const c="https://payment-service.dev.apero.vn";if(!t)throw new Error("Access token not found in localStorage");const o=await fetch(`${c}/saas-payment-service/v1/stripe/billing-portal-session`,{method:"POST",headers:{"x-api-bundleid":"com.astronex.hekaai",Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({callbackUrl:"/"})});if(!o.ok){const e=await o.json();throw new Error(`Request failed: ${o.status} - ${e.message||"Unknown error"}`)}return(await o.json()).url}catch{return null}}async function $(t){showLoadingScreen();let c=localStorage.getItem("accessToken");const o="https://payment-service.dev.apero.vn",s="com.astronex.hekaai";localStorage.getItem("redirectUri");const e=window.location.origin,n=await P(t);if(console.log("product: ",n),!n){hideLoadingScreen();return}console.log("product: ",n.price.id);try{const r={cart:[{stripePriceId:n.price.id,quantity:1,name:n.name}],successUrl:`${e}/payment/success`,cancelUrl:`${e}/payment/cancel`},i=await fetch(`${o}/saas-payment-service/v1/stripe/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`,"x-api-bundleid":s},body:JSON.stringify(r)}),l=await i.json();hideLoadingScreen(),i.ok&&(l!=null&&l.url)?window.location.href=l.url:(window.location.href="/",hideLoadingScreen())}catch{window.location.href="/",hideLoadingScreen()}}async function P(t){const c="https://payment-service.dev.apero.vn",o="com.astronex.hekaai",s=localStorage.getItem("accessToken");try{const e=await fetch(`${c}/saas-payment-service/v1/stripe/products`,{method:"GET",headers:{Authorization:`Bearer ${s}`,"x-api-bundleid":o}}),n=await e.json();if(e.ok&&Array.isArray(n.data))return n.data.find(r=>{var i;return((i=r.price)==null?void 0:i.id)===t})}catch(e){console.error("Lỗi lấy sản phẩm:",e)}return null}const T={class:"relative z-10 flex flex-col items-center text-center text-white p-6"},C={class:"grid grid-cols-2 gap-2 w-full mx-auto",style:{"padding-top":"21rem"}},L=["src"],j=["src"],z={__name:"PaywallModal",props:{visible:Boolean,backgroundUrl:{type:String,required:!0}},emits:["close","accepted","showSignInModal"],setup(t,{emit:c}){const o=p(!1),s=c,e=p("12months"),n={"1month":"price_1Rv9KoRCSaeQZuQ8X3z9HPcZ","12months":"price_1Rv9L2RCSaeQZuQ8UYdpvLun"},r=()=>s("close"),i=()=>{const u=n[e.value];if(!localStorage.getItem("accessToken")){console.log("no accessToken"),s("showSignInModal"),r();return}$(u),s("accepted",u)},l=u=>{e.value=u},v=()=>{isLoggedIn.value=!0,o.value=!1};return(u,d)=>(h(),g(x,null,[f(S,{name:"fade"},{default:w(()=>[t.visible?(h(),g("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center w-full h-full overflow-x-hidden overflow-y-auto bg-black bg-opacity-70",onKeydown:b(r,["esc"])},[a("div",{class:"relative w-full max-w-[270px] mx-auto rounded-2xl overflow-hidden shadow-lg",style:k({background:`url('${t.backgroundUrl}') no-repeat center center/cover`})},[a("button",{onClick:r,class:"absolute top-3 right-3 z-20 w-6 h-6 text-white bg-black bg-opacity-40 hover:bg-opacity-70 rounded-full flex items-center justify-center text-xs"}," ✕ "),a("div",T,[a("div",C,[a("div",{onClick:d[0]||(d[0]=m=>l("1month")),class:"cursor-pointer"},[a("img",{src:e.value==="1month"?"/images/onboarding/modal/1month_active.png":"/images/onboarding/modal/1month.png",alt:"1 month",class:"w-full"},null,8,L)]),a("div",{onClick:d[1]||(d[1]=m=>l("12months")),class:"cursor-pointer"},[a("img",{src:e.value==="12months"?"/images/onboarding/modal/12months_active.png":"/images/onboarding/modal/12months.png",alt:"12 months",class:"w-full"},null,8,j)])]),a("button",{onClick:i,class:"mt-2 w-full bg-gradient-to-r from-yellow-300 to-yellow-500 text-black font-bold py-2 rounded-xl shadow-md"}," Go Premium Now ")])],4)],32)):y("",!0)]),_:1}),f(_,{visible:o.value,onClose:d[2]||(d[2]=m=>o.value=!1),onLogin:v},null,8,["visible"])],64))}},B=I(z,[["__scopeId","data-v-1b2ecbfc"]]),O=Object.freeze(Object.defineProperty({__proto__:null,default:B},Symbol.toStringTag,{value:"Module"}));export{B as P,$ as a,O as b,N as c};
