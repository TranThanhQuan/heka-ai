import{k as p,h as b,b as g,o as h,a as S,e as o,u as r,Z as w,g as c,d as x,t as y,F as P}from"./app-DFeHoKxE.js";import{e as f}from"./tracking-Ch4ie_Zk.js";import{g as A,u as C}from"./auth-Drr8GQrd.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./helpers-BIkqR0Wr.js";const M={class:"min-h-screen flex items-center justify-center bg-[#e2ebfb]"},N={class:"text-center px-4 py-8 sm:px-6 sm:py-10 max-w-md w-11/12"},T={class:"text-base sm:text-lg text-left mb-6 space-y-2"},L={key:0,id:"email"},B={class:"text-black break-all"},H=["href"],V={__name:"Success",props:{sessionId:String},setup(D){let l=p(""),a=p(""),_=localStorage.getItem("checkoutId");localStorage.removeItem("checkoutId");let k=localStorage.getItem("payment_redirect_from");console.log("payment_redirect_from: ",k);const v=new URLSearchParams(window.location.search).get("id"),d=localStorage.getItem("accessToken");if(!v||!_)window.location.href="/";else{d&&A();const e=new URLSearchParams(window.location.search).get("session_id");if(e){const i=`https://api-heka.dev.apero.vn/api/v1/payment/verify-checkout-session?session_id=${e}`;$.ajax({url:i,method:"GET",success:function(t){console.log("✅ Dữ liệu trả về từ API:",t),t.success&&(l.value=t.data.email,f("iap_successfull",{convert_number:u+1,price_id:localStorage.getItem("priceId"),source:localStorage.getItem("source")}),f("confirm_purchased_with_store",{pi_id:t.data.pi_id,invoice_id:t.data.invoice_id,subscription_id:t.data.subscription_id,customerId:t.data.customerId,value:t.data.amountTotal,original_price:t.data.amountSubtotal,currency:t.data.currency,price_id:localStorage.getItem("priceId")}))},error:function(t,O,I){console.error("❌ Lỗi khi gọi API:",I),t.responseJSON&&console.error("Chi tiết lỗi:",t.responseJSON)}})}else console.warn("⚠️ No session_id");const u=parseInt(localStorage.getItem("checkoutCount"))||0;localStorage.setItem("checkoutCount",u+1),localStorage.getItem("package_id"),localStorage.removeItem("package_id");const m=["activity","goal","gender","year_of_birth","measure_type","current_weight","current_height","target_cal","goal_weight","start_date","end_date"],n={};m.forEach(i=>{const t=localStorage.getItem(i);t!==null&&t!==""&&(n[i]=t)}),m.every(i=>i in n)&&d&&C(n)}return l.value=localStorage.getItem("email"),b(()=>{if(result)a.value=result.clickURL;else{const s=navigator.userAgent;if(s.includes("iPhone")||s.includes("iPad")||s.includes("iPod"))a.value="https://apps.apple.com/app/heka-ai-calorie-counter/id6747111547";else if(s.includes("Android"))a.value="https://play.google.com/store/apps/details?id=com.heka.ai.caloriecounter.mealplan&hl=en";else{const e="https://apps.apple.com/app/heka-ai-calorie-counter/id6747111547".split(",");s.includes("iPhone")||s.includes("iPad")||s.includes("iPod")||s.includes("Android"),a.value=e[Math.floor(Math.random()*e.length)]}}}),(s,e)=>(h(),g(P,null,[S(r(w),{title:"Subscription Activated"}),o("div",M,[o("div",N,[e[3]||(e[3]=o("h4",{class:"text-lg sm:text-xl font-bold mb-4"},[c(" Thanks for being amazing with Heka AI."),o("br"),c(" Let's start your plan now! ")],-1)),e[4]||(e[4]=o("a",{href:"/"},[o("img",{src:"/images/icon.png",alt:"Heka Logo",class:"w-20 h-20 mx-auto my-4"})],-1)),o("ol",T,[e[1]||(e[1]=o("li",null,"1. Click on the link below to download Heka AI",-1)),e[2]||(e[2]=o("li",null,'2. Open the app and select "Sign in"',-1)),r(l)?(h(),g("li",L,[e[0]||(e[0]=c(" 3. Use your sign-up email: ")),o("strong",B,y(r(l)),1)])):x("",!0)]),o("a",{href:r(a),class:"block w-full bg-indigo-600 text-white font-semibold text-sm py-2.5 rounded-lg hover:bg-indigo-700 transition duration-200"}," Download Heka ",8,H),e[5]||(e[5]=o("a",{href:"/",class:"text-indigo-600 text-sm hover:text-indigo-800 block mt-3"},"Back to home",-1))])])],64))}},G=U(V,[["__scopeId","data-v-1c4f4cd6"]]);export{G as default};
